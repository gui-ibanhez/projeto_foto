{% load humanize %}
{% load l10n %}
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ store.code }} - {{ store.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
      .gallery img { object-fit: cover; width: 100%; height: 180px; }
      #map { height: 300px; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light px-3">
      <a class="navbar-brand" href="/">Galeria de Lojas</a>
      <a class="btn btn-outline-secondary" href="/admin/">Admin</a>
    </nav>

    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h3 class="mb-0">{{ store.code }} - {{ store.name }}</h3>
          <small class="text-muted">{{ store.address }} - {{ store.city }} / {{ store.state }}</small>
        </div>
      </div>

      {% if store.latitude and store.longitude %}
        <div id="map" class="mb-4"></div>
      {% endif %}

      <ul class="nav nav-pills mb-3">
        {% for section in sections %}
          <li class="nav-item">
            <a class="nav-link {% if forloop.first %}active{% endif %}" data-bs-toggle="tab" href="#section-{{ section.id }}">{{ section.name }}</a>
          </li>
        {% endfor %}
      </ul>

      <div class="tab-content">
        {% for section in sections %}
          <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="section-{{ section.id }}">
            <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-2 gallery">
              {% for photo in section.photos.all %}
                <div class="col">
                  <a href="{{ photo.image.url }}" target="_blank" title="{{ photo.description }}">
                    <img src="{{ photo.thumbnail.url|default:photo.image.url }}" alt="{{ photo.description }}" class="img-fluid rounded">
                  </a>
                </div>
              {% empty %}
                <p class="text-muted">Sem fotos nesta seção.</p>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    {% if store.latitude and store.longitude %}
    <script>
      const lat = parseFloat('{{ store.latitude|unlocalize }}');
      const lng = parseFloat('{{ store.longitude|unlocalize }}');
      const map = L.map('map').setView([lat, lng], 16);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      L.marker([lat, lng]).addTo(map)
        .bindPopup('{{ store.code }} - {{ store.name }}')
        .openPopup();
    </script>
    {% endif %}
  </body>
  </html>


